<!DOCTYPE html>
<html lang="en" ng-app="SwabhavTechlabs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/bootstrap.css">
    <script src="angular.js"></script>
    <title>Document</title>
</head>
<body class="container" style="margin-top: 10px">
    <section ng-controller='empController'>
        <label >Search</label>
        <input type="text" ng-model="searchText" placeholder="Enter text"><br>
        <button class="btn btn-primary" ng-click="showData()">Get Data</button>
        <div class="container" style="margin-top: 10px" >
            <table class="table table-striped" ng-hide="hidden">
                <tr>
                    <th>Employee Id</th>
                    <th>Employee Name</th>
                    <th>Employee Role</th>
                    <th>Manager Id</th>
                    <th>Joining Date</th>
                    <th>Salary</th>
                    <th>Commision</th>
                    <th>Department</th>
                    <th>Delete Data</th>
                </tr>
                <tbody ng-repeat="i in DataArray|orderBy:'empName'" ng-click="check($event)">
                    <tr>
                        <td>{{i.empId}}</td>
                        <td>{{i.empName}}</td>
                        <td>{{i.empRole}}</td>
                        <td>{{i.empManagerID}}</td>
                        <td>{{i.empJoiningDate}}</td>
                        <td>{{i.empSalary}}</td>
                        <td>{{i.empCommision}}</td>
                        <td>{{i.empdepartname}}</td>
                        <td><button class="glyphicon glyphicon-remove" value="{{i.empId}}"></button></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>
    <script>
        var app = angular.module('SwabhavTechlabs',[]);
        app.factory('empService',['$http',function($http){
            var serviceObj = {};
            let empobjArray =[];

            serviceObj.getArray = function(){
                let empobjArray =[];
                $http({
                method : "GET",
                url : 'http://localhost/angular/emp.txt'
            }).then(function mySuccess(response) {
                let strArray = response.data.split("\n");
                for (let i = 0; i < strArray.length; i++) {
                    strArray[i] = strArray[i].replace(/\s+/g, "");
                    strArray[i] = strArray[i].replace(/'/g,"");
                }
                strArray = strArray.filter(function (value, index, self) {
                    return self.indexOf(value) === index;
                });
                for(let i = 0;i<strArray.length;i++){
                    let row = strArray[i].split(",");
                    let obj = {
                        empId : row[0],
                        empName : row[1],
                        empRole : row[2],
                        empManagerID : row[3],
                        empJoiningDate : row[4],
                        empSalary : row[5],
                        empCommision : row[6],
                        empdepartname : row[7]
                    }
                    empobjArray.push(obj);
                }
            });
            return empobjArray;
            }

            serviceObj.delete = function(value,array){
                
                for(let i in array){

                    if (array[i].empId == value){
                        console.log(array[i]);
                        array.splice(i,1);
                        console.log(array.length);
                    }
                }
            }

            return serviceObj;
        }])

        app.controller('empController',['$scope','empService',function($scope,empService){
            $scope.hidden = true;
            $scope.DataArray = empService.getArray();

            $scope.showData = function(){
                $scope.hidden = false;
            }
            $scope.check = function(event){
                empService.delete(event.target.value,$scope.DataArray);
            }

            
        }])
    </script>
</body>
</html>